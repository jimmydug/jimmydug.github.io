<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Python," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="requests模块详解一开始学Python爬虫的时候，当时还处于Py2和Py3交替时期，网上许多资料都还是urllib2，找不到资料，又不会看源码，所以Py3的urllib模块用的就很蛋疼，后来被人安利了requests模块，确实很好用，现在完全告别urllib。">
<meta property="og:type" content="article">
<meta property="og:title" content="requests模块详解">
<meta property="og:url" content="http://yoursite.com/2017/09/19/requests模块详解/index.html">
<meta property="og:site_name" content="jimmydug's blog">
<meta property="og:description" content="requests模块详解一开始学Python爬虫的时候，当时还处于Py2和Py3交替时期，网上许多资料都还是urllib2，找不到资料，又不会看源码，所以Py3的urllib模块用的就很蛋疼，后来被人安利了requests模块，确实很好用，现在完全告别urllib。">
<meta property="og:updated_time" content="2017-09-29T08:22:18.814Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="requests模块详解">
<meta name="twitter:description" content="requests模块详解一开始学Python爬虫的时候，当时还处于Py2和Py3交替时期，网上许多资料都还是urllib2，找不到资料，又不会看源码，所以Py3的urllib模块用的就很蛋疼，后来被人安利了requests模块，确实很好用，现在完全告别urllib。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":true},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/09/19/requests模块详解/"/>





  <title> requests模块详解 | jimmydug's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jimmydug's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Love Life&Coding</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/19/requests模块详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jimmydug">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jimmydug's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                requests模块详解
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-19T15:30:08+08:00">
                2017-09-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="requests模块详解"><a href="#requests模块详解" class="headerlink" title="requests模块详解"></a>requests模块详解</h1><p>一开始学Python爬虫的时候，当时还处于Py2和Py3交替时期，网上许多资料都还是urllib2，找不到资料，又不会看源码，所以Py3的urllib模块用的就很蛋疼，后来被人安利了<strong>requests</strong>模块，确实很好用，现在完全告别urllib。<a id="more"></a><br>以<a href="https://www.baidu.com/" target="_blank" rel="external">百度</a>为例来介绍一下requests的用法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; import requests  </div><div class="line">&gt;&gt;&gt; import json</div><div class="line">&gt;&gt;&gt; headers = &#123;<span class="string">'User-Agent'</span> : <span class="string">''</span>&#125;</div><div class="line">&gt;&gt;&gt; res = requests.get(<span class="string">'https://www.baidu.com/'</span>, headers=headers)   <span class="comment"># get方法</span></div><div class="line">&gt;&gt; <span class="built_in">type</span>(res)    <span class="comment"># 响应对象类型</span></div><div class="line">requests.models.Response</div><div class="line">&gt;&gt;&gt; res.status_code    <span class="comment"># 状态码，200正常</span></div><div class="line">200</div><div class="line">&gt;&gt;&gt; res.url</div><div class="line"><span class="string">'https://www.baidu.com/'</span></div><div class="line">&gt;&gt;&gt; res.cookies    <span class="comment"># 查看cookies</span></div><div class="line">&lt;RequestsCookieJar[Cookie(version=0, name=<span class="string">'BDORZ'</span>, value=<span class="string">'27315'</span>, port=None, port_specified=False, domain=<span class="string">'.baidu.com'</span>, domain_specified=True, domain_initial_dot=True, path=<span class="string">'/'</span>, path_specified=True, secure=False, expires=1506066864, discard=False, comment=None, comment_url=None, rest=&#123;&#125;, rfc2109=False)]&gt;</div><div class="line">&gt;&gt;&gt; res.request.headers    <span class="comment"># 请求头</span></div><div class="line">&#123;<span class="string">'User-Agent'</span>: <span class="string">'python-requests/2.12.4'</span>, <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>, <span class="string">'Accept'</span>: <span class="string">'*/*'</span>, <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>&#125;</div><div class="line">&gt;&gt;&gt; res.headers    <span class="comment"># 响应头</span></div><div class="line">&#123;<span class="string">'Cache-Control'</span>: <span class="string">'private, no-cache, no-store, proxy-revalidate, no-transform'</span>, <span class="string">'Connection'</span>: <span class="string">'Keep-Alive'</span>, <span class="string">'Content-Encoding'</span>: <span class="string">'gzip'</span>, <span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>, <span class="string">'Date'</span>: <span class="string">'Thu, 21 Sep 2017 07:55:05 GMT'</span>, <span class="string">'Last-Modified'</span>: <span class="string">'Mon, 23 Jan 2017 13:23:55 GMT'</span>, <span class="string">'Pragma'</span>: <span class="string">'no-cache'</span>, <span class="string">'Server'</span>: <span class="string">'bfe/1.0.8.18'</span>, <span class="string">'Set-Cookie'</span>: <span class="string">'BDORZ=27315; max-age=86400; domain=.baidu.com; path=/'</span>, <span class="string">'Transfer-Encoding'</span>: <span class="string">'chunked'</span>&#125;</div><div class="line"><span class="comment"># 这个还不太了解</span></div><div class="line">&gt;&gt;&gt; res.history</div><div class="line">[]</div></pre></td></tr></table></figure></p>
<p>从响应的response中提取数据，其中<strong>res.text</strong>只能获取<strong>文本</strong>数据，返回<strong>字符串</strong>，而<strong>res.content</strong>返回<strong>二进制数据</strong>，包括文本，图片等，下载图片时可以用res.content提取数据，另外俩者都要注意<strong>编解码</strong>问题。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看URL编码 </span></div><div class="line">&gt;&gt;&gt; res.encoding <span class="comment"># 这是默认编码，可以指定</span></div><div class="line"><span class="string">'ISO-8859-1'</span></div><div class="line"><span class="comment"># 按默认编码获取文本（ISO编码下中文变成乱码），返回String</span></div><div class="line">&gt;&gt;&gt; res.text    </div><div class="line"><span class="string">'&lt;!DOCTYPE html&gt;\r\n&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=IE=Edge&gt;&lt;meta content=always name=referrer&gt;&lt;link rel=stylesheet type=text/css href=https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css&gt;&lt;title&gt;ç\x99¾åº¦ä¸\x80ä¸\x8bï¼\x8cä½\xa0å°±ç\x9f¥é\x81\x93…………&lt;/body&gt; &lt;/html&gt;\r\n'</span></div><div class="line"></div><div class="line"><span class="comment"># 指定URL编码</span></div><div class="line">&gt;&gt;&gt; res.encoding=<span class="string">'utf-8'</span></div><div class="line">&gt;&gt;&gt; res.text    <span class="comment"># 这下没有乱码了，返回String</span></div><div class="line"><span class="string">'&lt;!DOCTYPE html&gt;\r\n&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=IE=Edge&gt;&lt;meta content=always name=referrer&gt;&lt;link rel=stylesheet type=text/css href=https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css&gt;&lt;title&gt;百度一下，你就知道&lt;/title&gt;&lt;/head&gt;………… &lt;body link=#0000cc&gt;…………&lt;/body&gt; &lt;/html&gt;\r\n'</span></div><div class="line"><span class="comment"># 返回响应的二进制数据</span></div><div class="line">&gt;&gt;&gt; <span class="built_in">type</span>(res.content)</div><div class="line">bytes</div><div class="line">&gt;&gt;&gt; res.content  </div><div class="line">b<span class="string">'&lt;!DOCTYPE html&gt;\r\n&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=IE=Edge&gt;&lt;meta content=always name=referrer&gt;&lt;link rel=stylesheet type=text/css href=https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css&gt;&lt;title&gt;\xe7\x99\xbe\xe5\xba\xa6\xe4\xb8\x80\xe4\xb8\x8b\xef\x…………&lt;/body&gt; &lt;/html&gt;\r\n'</span></div><div class="line"><span class="comment"># utf-8解码后返回String</span></div><div class="line">&gt;&gt;&gt; res.content.decode(<span class="string">'utf-8'</span>)</div><div class="line"><span class="string">'&lt;!DOCTYPE html&gt;\r\n&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=IE=Edge&gt;&lt;meta content=always name=referrer&gt;&lt;link rel=stylesheet type=text/css href=https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css&gt;&lt;title&gt;百度一下，你就知道&lt;/title&gt;&lt;/head&gt; &lt;body link=#0000cc&gt; &lt;div id=wrapper&gt;…………&lt;/body&gt; &lt;/html&gt;\r\n'</span></div><div class="line"><span class="comment"># 做个小测试(在设置res.encoding='utf-8'之后)</span></div><div class="line">&gt;&gt;&gt; res.text == res.content.decode(<span class="string">'utf-8'</span>)</div><div class="line">True</div></pre></td></tr></table></figure></p>
<h2 id="关于headers"><a href="#关于headers" class="headerlink" title="关于headers"></a>关于headers</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h2 id="发送其他类型请求"><a href="#发送其他类型请求" class="headerlink" title="发送其他类型请求"></a>发送其他类型请求</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">res = requests.post(<span class="string">"http://httpbin.org/post"</span>)  <span class="comment"># post</span></div><div class="line">res = requests.put(<span class="string">"http://httpbin.org/put"</span>)    <span class="comment"># put</span></div><div class="line">res = requests.delete(<span class="string">"http://httpbin.org/delete"</span>) <span class="comment">#delete</span></div><div class="line">res = requests.head(<span class="string">"http://httpbin.org/get"</span>)   <span class="comment"># head </span></div><div class="line">res = requests.options(<span class="string">"http://httpbin.org/get"</span>) <span class="comment"># options</span></div></pre></td></tr></table></figure>
<h2 id="处理JSON数据"><a href="#处理JSON数据" class="headerlink" title="处理JSON数据"></a>处理JSON数据</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># get一个json格式文件  </span></div><div class="line">&gt;&gt;&gt; res = requests.get(<span class="string">'https://movie.douban.com/j/search_subjects?type=movie&amp;tag=经典&amp;sort=recommend&amp;page_limit=20&amp;page_start=0'</span>)</div><div class="line">&gt;&gt;&gt; <span class="built_in">type</span>(res)</div><div class="line">requests.models.Response</div><div class="line">&gt;&gt;&gt; <span class="built_in">type</span>(res.text)</div><div class="line">str</div><div class="line"><span class="comment"># 如果响应response是json形式</span></div><div class="line">&gt;&gt;&gt; <span class="built_in">type</span>(res.json())  <span class="comment"># .json()变为dict</span></div><div class="line">dict</div></pre></td></tr></table></figure>
<h2 id="url中传递参数的GET请求-常用于搜索"><a href="#url中传递参数的GET请求-常用于搜索" class="headerlink" title="url中传递参数的GET请求(常用于搜索)"></a>url中传递参数的GET请求(常用于搜索)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 参数为dict格式</span></div><div class="line">keyword = &#123;<span class="string">'key1'</span>: <span class="string">'value1'</span>, <span class="string">'key2'</span>: <span class="string">'value2'</span>&#125;</div><div class="line"><span class="comment"># 参数传给params  </span></div><div class="line">res = requests.get(<span class="string">"http://httpbin.org/get"</span>, params=keyword)  </div><div class="line">res.url)</div><div class="line"><span class="comment"># 看个例子</span></div><div class="line">&gt;&gt;&gt; search = &#123;<span class="string">'wd'</span> : <span class="string">'成龙新电影'</span>&#125;</div><div class="line">&gt;&gt;&gt; res = requests.get(<span class="string">'https://baidu.com/s'</span>, params=search)</div><div class="line">&gt;&gt;&gt;&gt; res.url</div><div class="line"><span class="string">'http://www.baidu.com/s?wd=%E6%88%90%E9%BE%99%E6%96%B0%E7%94%B5%E5%BD%B1'</span></div><div class="line"><span class="comment"># 这个网址等同于http://www.baidu.com/s?wd=成龙新电影</span></div><div class="line">```  </div><div class="line"><span class="comment">## 创建图片(方法不唯一)</span></div><div class="line">```bash  </div><div class="line">from PIL import Image  </div><div class="line">from io import StringIO  </div><div class="line">i= Image.open(StringIO.StringIO(res.content))  </div><div class="line">```  </div><div class="line"><span class="comment">## 超时处理(timeout参数) </span></div><div class="line">```bash</div><div class="line">requests.get(<span class="string">'http://github.com'</span>,timeout=1)</div></pre></td></tr></table></figure>
<h2 id="设置代理IP-proxies"><a href="#设置代理IP-proxies" class="headerlink" title="设置代理IP(proxies)"></a>设置代理IP(proxies)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">proxies = &#123;</div><div class="line">    <span class="string">'http'</span>: <span class="string">'socks5://127.0.0.1:9742'</span>,</div><div class="line">    <span class="string">'https'</span>: <span class="string">'socks5://127.0.0.1:9742'</span>&#125;</div><div class="line"><span class="comment"># proxies参数</span></div><div class="line">res = requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</div></pre></td></tr></table></figure>
<h2 id="COOKIES"><a href="#COOKIES" class="headerlink" title="COOKIES"></a>COOKIES</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>无证书访问，关闭SSL验证</p>
<h1 id="关闭验证，但是仍然会报出证书警告"><a href="#关闭验证，但是仍然会报出证书警告" class="headerlink" title="关闭验证，但是仍然会报出证书警告"></a>关闭验证，但是仍然会报出证书警告</h1><p>response = requests.get(‘<a href="https://www.12306.cn" target="_blank" rel="external">https://www.12306.cn</a>‘, verify=False)</p>
<p>##<br>添加头部<br>import json<br>url = ‘<a href="https://api.github.com/some/endpoint" target="_blank" rel="external">https://api.github.com/some/endpoint</a>‘<br>payload = {‘some’: ‘data’}<br>headers = {‘content-type’: ‘application/json’}<br>res = requests.post(url, data=json.dumps(payload), headers=headers)  </p>
<p>发送表单数据<br>paylaod={“key1”:”value1”,”key2”:”value2”}<br>res=requests.post(“<a href="http://httpbin.org/post&quot;,data=paylaod" target="_blank" rel="external">http://httpbin.org/post&quot;,data=paylaod</a>)<br>print(res.text)  </p>
<p>发送string数据<br>import json<br>payload={“key1”:”value1”,”key2”:”value2”}<br>res=requests.post(“<a href="http://httpbin.org/post&quot;,data=json.dumps(payload" target="_blank" rel="external">http://httpbin.org/post&quot;,data=json.dumps(payload</a>))<br>print(res.text)  </p>
<p>发送文件<br>url=’<a href="http://httpbin.org/post" target="_blank" rel="external">http://httpbin.org/post</a>‘<br>files={‘file’:open(‘report.xls’,’rb’)}<br>显式设置文件名，文件类型，请求头：<br>files={‘file’: (‘report.xls’, open(‘report.xls’, ‘rb’), ‘application/vnd.ms-excel’, {‘Expires’: ‘0’})}<br>发送文件形式的字符串<br>files={‘file’: (‘report.csv’, ‘some,data,to,send\nanother,row,to,send\n’)}<br>res=requests.post(url,files=files)<br>print(res.text)  </p>
<p>cookies<br>url=’<a href="http://example.com/some/cookie/setting/url" target="_blank" rel="external">http://example.com/some/cookie/setting/url</a>‘<br>res=requests.get(url)<br>print(res.cookies[‘example_cookie_name’])  #报错  </p>
<p>发送cookies<br>url = ‘<a href="http://httpbin.org/cookies" target="_blank" rel="external">http://httpbin.org/cookies</a>‘<br>cookies = dict(cookies_are=’working’)<br>res = requests.get(url, cookies=cookies)<br>print(res.text)     </p>
<p>#跨请求保存cookies  </p>
<p>##s = requests.Session()  </p>
<p>##s.get(‘<a href="http://httpbin.org/cookies/set/sessioncookie/123456789" target="_blank" rel="external">http://httpbin.org/cookies/set/sessioncookie/123456789</a>‘)  </p>
<p>##r = s.get(“<a href="http://httpbin.org/cookies" target="_blank" rel="external">http://httpbin.org/cookies</a>“)  </p>
<p>##print(r.text)  </p>
<p>#请求保存缺省数据  </p>
<p>##s = requests.Session()  </p>
<p>##s.auth = (‘user’, ‘pass’)  </p>
<p>##s.headers.update({‘x-test’: ‘true’})  </p>
<h3 id="both-‘x-test’-and-‘x-test2’-are-sent"><a href="#both-‘x-test’-and-‘x-test2’-are-sent" class="headerlink" title="both ‘x-test’ and ‘x-test2’ are sent"></a>both ‘x-test’ and ‘x-test2’ are sent</h3><p>##r=s.get(‘<a href="http://httpbin.org/headers" target="_blank" rel="external">http://httpbin.org/headers</a>‘, headers={‘x-test2’: ‘true’})  </p>
<p>##print(r.text)  </p>
<p>#设置SSL证书  </p>
<p>#requests.get(‘<a href="https://kennethreitz.com" target="_blank" rel="external">https://kennethreitz.com</a>‘, cert=(‘/path/server.crt’, ‘/path/key’))<br>```</p>
<p>2.2、基本POST请求</p>
<h1 id="设置传入post表单信息"><a href="#设置传入post表单信息" class="headerlink" title="设置传入post表单信息"></a>设置传入post表单信息</h1><p>data= { ‘name’:’jyx’, ‘age’:18}</p>
<h1 id="设置请求头信息"><a href="#设置请求头信息" class="headerlink" title="设置请求头信息"></a>设置请求头信息</h1><p>headers = {<br>      “User-Agent”: “Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36”<br>}</p>
<h1 id="设置请求头信息和POST请求参数-data"><a href="#设置请求头信息和POST请求参数-data" class="headerlink" title="设置请求头信息和POST请求参数(data)"></a>设置请求头信息和POST请求参数(data)</h1><p>response = requests.post(‘<a href="http://httpbin.org/post" target="_blank" rel="external">http://httpbin.org/post</a>‘, data=data, headers=headers)<br>print(response.text)</p>
<p>4.1、文件上传</p>
<p>files = {‘file’:open(‘favicon.ico’,’rb’)}</p>
<h1 id="往POST请求头中设置文件-files"><a href="#往POST请求头中设置文件-files" class="headerlink" title="往POST请求头中设置文件(files)"></a>往POST请求头中设置文件(files)</h1><p>response = requests.post(‘<a href="http://httpbin.org/post&#39;,files=files" target="_blank" rel="external">http://httpbin.org/post&#39;,files=files</a>)<br>print(response.text)<br>4.2、获取cookies</p>
<p>response = requests.get(‘<a href="https://www.baidu.com" target="_blank" rel="external">https://www.baidu.com</a>‘)<br>print(response.cookies)<br>for key,value in response.cookies.items():<br>    print(key,’=====’,value)<br>4.3、会话维持</p>
<p>requests.get(‘<a href="http://httpbin.org/cookies/set/number/12456" target="_blank" rel="external">http://httpbin.org/cookies/set/number/12456</a>‘)<br>response = requests.get(‘<a href="http://httpbin.org/cookies" target="_blank" rel="external">http://httpbin.org/cookies</a>‘)</p>
<h1 id="本质上是两次不同的请求，session不一致"><a href="#本质上是两次不同的请求，session不一致" class="headerlink" title="本质上是两次不同的请求，session不一致"></a>本质上是两次不同的请求，session不一致</h1><p>print(response.text)<br>4.3.2、会话维持请求</p>
<h1 id="从Requests中获取session"><a href="#从Requests中获取session" class="headerlink" title="从Requests中获取session"></a>从Requests中获取session</h1><p>session = requests.Session()</p>
<h1 id="使用seesion去请求保证了请求是同一个session"><a href="#使用seesion去请求保证了请求是同一个session" class="headerlink" title="使用seesion去请求保证了请求是同一个session"></a>使用seesion去请求保证了请求是同一个session</h1><p>session.get(‘<a href="http://httpbin.org/cookies/set/number/12456" target="_blank" rel="external">http://httpbin.org/cookies/set/number/12456</a>‘)<br>response = session.get(‘<a href="http://httpbin.org/cookies" target="_blank" rel="external">http://httpbin.org/cookies</a>‘)<br>print(response.text)<br>4.4、证书验证</p>
<p>4.4.1、无证书访问</p>
<h1 id="关闭验证，但是仍然会报出证书警告-1"><a href="#关闭验证，但是仍然会报出证书警告-1" class="headerlink" title="关闭验证，但是仍然会报出证书警告"></a>关闭验证，但是仍然会报出证书警告</h1><p>response = requests.get(‘<a href="https://www.12306.cn&#39;,verify=False" target="_blank" rel="external">https://www.12306.cn&#39;,verify=False</a>)<br>print(response.status_code)<br>4.4.3、消除关闭证书验证的警告</p>
<p>from requests.packages import urllib3</p>
<h1 id="关闭警告"><a href="#关闭警告" class="headerlink" title="关闭警告"></a>关闭警告</h1><p>urllib3.disable_warnings()  #关闭警告<br>response = requests.get(‘<a href="https://www.12306.cn&#39;,verify=False" target="_blank" rel="external">https://www.12306.cn&#39;,verify=False</a>)<br>print(response.status_code)<br>4.4.4、手动设置证书</p>
<h1 id="设置本地证书"><a href="#设置本地证书" class="headerlink" title="设置本地证书"></a>设置本地证书</h1><p>response = requests.get(‘<a href="https://www.12306.cn" target="_blank" rel="external">https://www.12306.cn</a>‘, cert=(‘/path/server.crt’, ‘/path/key’))<br>print(response.status_code)<br>4.5、代理设置</p>
<p>4.5.1、设置普通代理</p>
<p>proxies = {<br>    “http”: “<a href="http://127.0.0.1:9743" target="_blank" rel="external">http://127.0.0.1:9743</a>“,<br>    “https”: “<a href="https://127.0.0.1:9743" target="_blank" rel="external">https://127.0.0.1:9743</a>“,<br>}</p>
<h1 id="往请求中设置代理-proxies"><a href="#往请求中设置代理-proxies" class="headerlink" title="往请求中设置代理(proxies"></a>往请求中设置代理(proxies</h1><p>)<br>response = requests.get(“<a href="https://www.taobao.com" target="_blank" rel="external">https://www.taobao.com</a>“, proxies=proxies)<br>print(response.status_code)<br>4.5.2、设置带有用户名和密码的代理</p>
<p>proxies = {<br>    “http”: “<a href="http://user:password@127.0.0.1:9743/" target="_blank" rel="external">http://user:password@127.0.0.1:9743/</a>“,<br>}<br>response = requests.get(“<a href="https://www.taobao.com" target="_blank" rel="external">https://www.taobao.com</a>“, proxies=proxies)<br>print(response.status_code)</p>
<p>4.6、超时设置</p>
<p>from requests.exceptions import ReadTimeout</p>
<p>try:</p>
<h1 id="设置必须在500ms内收到响应，不然或抛出ReadTimeout异常"><a href="#设置必须在500ms内收到响应，不然或抛出ReadTimeout异常" class="headerlink" title="设置必须在500ms内收到响应，不然或抛出ReadTimeout异常"></a>设置必须在500ms内收到响应，不然或抛出ReadTimeout异常</h1><p>   response = requests.get(“<a href="http://httpbin.org/get" target="_blank" rel="external">http://httpbin.org/get</a>“, timeout=0.5)<br>            print(response.status_code)<br>except ReadTimeout:<br>   print(‘Timeout’)<br>4.7、认证设置</p>
<p>import requests<br>from requests.auth import HTTPBasicAuth</p>
<p>r = requests.get(‘<a href="http://120.27.34.24:9001" target="_blank" rel="external">http://120.27.34.24:9001</a>‘, auth=HTTPBasicAuth(‘user’, ‘123’))</p>
<h1 id="r-requests-get-‘http-120-27-34-24-9001‘-auth-‘user’-‘123’"><a href="#r-requests-get-‘http-120-27-34-24-9001‘-auth-‘user’-‘123’" class="headerlink" title="r = requests.get(‘http://120.27.34.24:9001‘, auth=(‘user’, ‘123’))"></a>r = requests.get(‘<a href="http://120.27.34.24:9001" target="_blank" rel="external">http://120.27.34.24:9001</a>‘, auth=(‘user’, ‘123’))</h1><p>print(r.status_code)<br>4.8、异常处理<br>from requests.exceptions import ReadTimeout, ConnectionError, RequestException<br>try:<br>   response = requests.get(“<a href="http://httpbin.org/get" target="_blank" rel="external">http://httpbin.org/get</a>“, timeout = 0.5)<br>   print(response.status_code)<br>except ReadTimeout:</p>
<h1 id="超时异常"><a href="#超时异常" class="headerlink" title="超时异常"></a>超时异常</h1><p>   print(‘Timeout’)<br>except ConnectionError:</p>
<h1 id="连接异常"><a href="#连接异常" class="headerlink" title="连接异常"></a>连接异常</h1><p>   print(‘Connection error’)<br>except RequestException:</p>
<h1 id="请求异常"><a href="#请求异常" class="headerlink" title="请求异常"></a>请求异常</h1><p>   print(‘Error’)</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"># Python</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/09/19/Python文件操作和os模块/" rel="next" title="Python文件操作和os模块">
                <i class="fa fa-chevron-left"></i> Python文件操作和os模块
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/09/20/Python迭代器、迭代对象、生成器/" rel="prev" title="Python迭代器、迭代对象、生成器">
                Python迭代器、迭代对象、生成器 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="jimmydug" />
          <p class="site-author-name" itemprop="name">jimmydug</p>
           
              <p class="site-description motion-element" itemprop="description">Want Success Entremely!!!</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">34</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#requests模块详解"><span class="nav-number">1.</span> <span class="nav-text">requests模块详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#关于headers"><span class="nav-number">1.1.</span> <span class="nav-text">关于headers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#发送其他类型请求"><span class="nav-number">1.2.</span> <span class="nav-text">发送其他类型请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#处理JSON数据"><span class="nav-number">1.3.</span> <span class="nav-text">处理JSON数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#url中传递参数的GET请求-常用于搜索"><span class="nav-number">1.4.</span> <span class="nav-text">url中传递参数的GET请求(常用于搜索)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置代理IP-proxies"><span class="nav-number">1.5.</span> <span class="nav-text">设置代理IP(proxies)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#COOKIES"><span class="nav-number">1.6.</span> <span class="nav-text">COOKIES</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关闭验证，但是仍然会报出证书警告"><span class="nav-number">2.</span> <span class="nav-text">关闭验证，但是仍然会报出证书警告</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#both-‘x-test’-and-‘x-test2’-are-sent"><span class="nav-number">2.0.1.</span> <span class="nav-text">both ‘x-test’ and ‘x-test2’ are sent</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#设置传入post表单信息"><span class="nav-number">3.</span> <span class="nav-text">设置传入post表单信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#设置请求头信息"><span class="nav-number">4.</span> <span class="nav-text">设置请求头信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#设置请求头信息和POST请求参数-data"><span class="nav-number">5.</span> <span class="nav-text">设置请求头信息和POST请求参数(data)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#往POST请求头中设置文件-files"><span class="nav-number">6.</span> <span class="nav-text">往POST请求头中设置文件(files)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#本质上是两次不同的请求，session不一致"><span class="nav-number">7.</span> <span class="nav-text">本质上是两次不同的请求，session不一致</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#从Requests中获取session"><span class="nav-number">8.</span> <span class="nav-text">从Requests中获取session</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用seesion去请求保证了请求是同一个session"><span class="nav-number">9.</span> <span class="nav-text">使用seesion去请求保证了请求是同一个session</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关闭验证，但是仍然会报出证书警告-1"><span class="nav-number">10.</span> <span class="nav-text">关闭验证，但是仍然会报出证书警告</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关闭警告"><span class="nav-number">11.</span> <span class="nav-text">关闭警告</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#设置本地证书"><span class="nav-number">12.</span> <span class="nav-text">设置本地证书</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#往请求中设置代理-proxies"><span class="nav-number">13.</span> <span class="nav-text">往请求中设置代理(proxies</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#设置必须在500ms内收到响应，不然或抛出ReadTimeout异常"><span class="nav-number">14.</span> <span class="nav-text">设置必须在500ms内收到响应，不然或抛出ReadTimeout异常</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#r-requests-get-‘http-120-27-34-24-9001‘-auth-‘user’-‘123’"><span class="nav-number">15.</span> <span class="nav-text">r = requests.get(‘http://120.27.34.24:9001‘, auth=(‘user’, ‘123’))</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#超时异常"><span class="nav-number">16.</span> <span class="nav-text">超时异常</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#连接异常"><span class="nav-number">17.</span> <span class="nav-text">连接异常</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#请求异常"><span class="nav-number">18.</span> <span class="nav-text">请求异常</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jimmydug</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
